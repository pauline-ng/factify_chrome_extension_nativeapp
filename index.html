<html><head>
    <meta charset="utf-8">
    <title>Factify Chrome Installer</title>
    <script src="http://java.com/js/deployJava.js"></script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <link href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://pingendo.github.io/pingendo-bootstrap/themes/default/bootstrap.css" rel="stylesheet" type="text/css">
    <script>
      // Get User Home directory path
      const os = require('os')
      const dir_home = os.homedir()

      //var dir_home = process.env[process.platform == "win32" ? "USERPROFILE" : "HOME"];
      let dir_tmp = dir_home + "\\factify_chrome";
      console.log("Use tmp folder: " + dir_tmp);

      // Get host_program directory path
      var dir_host = __dirname + "\\host_program";
      console.log("host program folder: " + dir_host);

      // Copy host_program under user home
      var fs = require('fs-extra');
      
      //Install host program
      function Install(){
            //Step1: Java check by using deployJava.js
            			const shell = require('electron').shell
                                	
                        if(!deployJava.versionCheck("1.8")){
                          console.log("JRE 1.8 is NOT installed!");
                          shell.openExternal('https://java.com/download/') // use external link instead of main window
                          // deployJava.installLatestJRE(); // TODO: ask user to redirect
            
                        }else{
                          console.log("JRE 1.8 is installed!");
                          deployJava.installJRE("1.8");
                          // deployJava.getJREs(); // this does not work somehow...
                        }
                          //Step2: expand host_program folder under %AppData% - it's fixed

                          fs.copySync(dir_host, dir_tmp);
                          
                  
                  			
            			//Step3: run install_host.bat (windows) or install_host.sh (mac/linux) - uninstall_host.bat/sh first is better      
            			console.log("Your Operating System is " + navigator.platform);
                  const platform = navigator.platform;
                  if(platform == "Win32"){

                    //var file = __dirname + "\\host_program\\factify_launcher.bat";
                    var host_install_file = dir_tmp + "\\install_host.bat";

                    console.log("<br> file path: <br>" + host_install_file + "<br>");
                    //console.log(cmd);

                    var spawn = require('child_process').spawn,
                        ls    = spawn('cmd.exe', ['/c', host_install_file]);

                    ls.stdout.on('data', function (data) {
                      console.log('stdout: ' + data);
                    });

                    ls.stderr.on('data', function (data) {
                      console.log('stderr: ' + data);
                    });

                    ls.on('exit', function (code) {
                      console.log('child process exited with code ' + code);
                    });


                  }else if(os == "Mac" || os == "Linux"){
                    // Mac or Linux
                    console.log("it doesn't support Mac/Linux yet");

                  }else{
                    // Cannot recognize your platform.
                    console.log("unknown error has occured.");
                  }
      }
      
		// Uninstall host_program
      function Uninstall(){
      	
            fs.removeSync(dir_tmp);
        
		}
    </script>
  </head><body>
    <div class="section">
      <div class="container">
        <div class="row">
          <div class="col-md-12 text-center">
            <h4>Factify Chrome Installer</h4>
          </div>
        </div>
        <div class="row">
          <div class="container">
            <img src="./img/logo_factpub.png" class="center-block img-responsive">
            <br>
            <div class="col text-center">
            </div>
            <br>
            <div class="col text-center">
              <a class="btn btn-success" onclick="Install()">Install</a>
              <a class="btn btn-danger" onclick="Uninstall()">Uninstall</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  

</body></html>